<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/css/services.css" />
    <link
      rel="icon"
      type="image/x-icon"
      href="assets/css/images/icons/favicon.ico"
    />

    <title>Zaamom | Services</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
      // Initialize EmailJS when script loads
      (function() {
        if (typeof emailjs !== 'undefined') {
          emailjs.init("Qi6B3pWYB6Ysn-vCi");
        } else {
          window.addEventListener('load', function() {
            if (typeof emailjs !== 'undefined') {
              emailjs.init("Qi6B3pWYB6Ysn-vCi");
            }
          });
        }
      })();
      
      function initMenu() {
        var hamburger = document.querySelector(".hamburger");
        var nav = document.querySelector("#primary-navigation");
        if (!hamburger || !nav) return;

        hamburger.addEventListener("click", function () {
          var isOpen = nav.classList.toggle("show");
          hamburger.setAttribute("aria-expanded", isOpen);
          nav.setAttribute("aria-hidden", (!isOpen).toString());
        });
      }
    </script>
  </head>

  <body class="has-offcanvas">
    <a href="index.html">
      <div class="logo-icesco">
        <img src="assets/css/images/logo-zaamom-horizontal.png" alt="" />
      </div>
    </a>
    <button
      class="hamburger"
      aria-expanded="false"
      aria-controls="primary-navigation"
      aria-label="Toggle primary navigation"
    >
      <img
        class="burger"
        src="assets/css/images/icons/menu-burger.png"
        alt="Open menu"
      />
    </button>

    <nav id="primary-navigation" class="menu-panel" aria-hidden="true">
      <a class="menu-link" href="About.html" title="About" aria-label="About">
        <img src="assets/css/images/about.png" alt="" />
      </a>
      <a
        class="menu-link"
        href="gallery.html"
        title="Gallery"
        aria-label="Gallery"
      >
        <img src="assets/css/images/gallery.png" alt="" />
      </a>
      <a
        class="menu-link"
        href="contact.html"
        title="Contact"
        aria-label="Contact"
      >
        <img src="assets/css/images/contact.png" alt="" />
      </a>
      <a class="menu-link" href="store.html" title="Store" aria-label="Store">
        <img src="assets/css/images/store.png" alt="" />
      </a>
      <a
        class="menu-link"
        href="services.html"
        title="Services"
        aria-label="Services"
      >
        <img src="assets/css/images/services.png" alt="" />
      </a>
    </nav>

    <main class="gallery-hero">
      <img
        class="gallery-wordmark"
        src="assets/css/images/services.png"
        alt="Services"
      />
      <p class="gallery-intro">
        A snapshot of what keeps Zaamom
        universe in motion.
      </p>
    </main>

    <section class="services-cards">
      <div class="card dark" data-service="caricature" tabindex="0">
        <img src="assets/css/images/Photos/CARICATURE/caricature18.jpg" alt="Caricature" />
        <section>
          <h2>Caricature</h2>
          <p>Personalized portraits with a unique artistic twist. Perfect for events and gifts.</p>
          <div>
            <div class="tag" aria-label="Events">
              <i class="fa-solid fa-user-pen"></i> Events
            </div>
            <button>Contact</button>
          </div>
        </section>
      </div>

      <div class="card dark" data-service="graffiti" tabindex="0">
        <img src="assets/css/images/Photos/STREETART/streetart8.jpg" alt="Graffiti" />
        <section>
          <h2>Graffiti</h2>
          <p>Bold and vibrant murals that transform spaces. Large-scale projects and installations.</p>
          <div>
            <div class="tag" aria-label="Large scale">
              <i class="fa-solid fa-spray-can"></i> Large Scale
            </div>
            <button>Contact</button>
          </div>
        </section>
      </div>

      <div class="card dark" data-service="talks" tabindex="0">
        <img src="assets/css/images/Photos/talks1.png" alt="Talks" />
        <section>
          <h2>Talks</h2>
          <p>Engaging presentations and discussions about art, creativity, and street culture.</p>
          <div>
            <div class="tag" aria-label="Presentations">
              <i class="fa-solid fa-microphone"></i> Presentations
            </div>
            <button>Contact</button>
          </div>
        </section>
      </div>
    </section>

    <div
      id="order-modal"
      class="polaroid-modal"
      aria-hidden="true"
      role="dialog"
    >
      <div class="modal-overlay" data-close-modal></div>
      <div class="modal-content form-modal">
        <button class="modal-close" aria-label="Close form" data-close-modal>
          &times;
        </button>
        <form id="order-form" class="order-form">
          <h2 id="form-title" class="form-title">Service Request</h2>
          
          <div class="form-group">
            <label for="customer-name">Name *</label>
            <input type="text" id="customer-name" name="name" required />
          </div>

          <div class="form-group">
            <label for="customer-email">Email *</label>
            <input type="email" id="customer-email" name="email" required />
          </div>

          <div class="form-group">
            <label for="customer-phone">Phone *</label>
            <input 
              type="tel" 
              id="customer-phone" 
              name="phone" 
              pattern="^[\+]?[0-9\s\-\(\)\.]{7,20}$"
              title="Please enter a valid phone number (7-15 digits, formats like +1234567890, (123) 456-7890, or 123-456-7890)"
              required 
            />
          </div>

          <div class="form-group">
            <label for="customer-company">Company</label>
            <input type="text" id="customer-company" name="company" />
          </div>

          <div id="dynamic-fields"></div>

          <div class="form-group">
            <label for="customer-message">Message</label>
            <textarea
              id="customer-message"
              name="message"
              rows="4"
              placeholder="Tell us more about your request..."
            ></textarea>
          </div>

          <button type="submit" class="submit-btn">Send Request</button>
        </form>
      </div>
    </div>

    <script>
      const modal = document.getElementById("order-modal");
      const form = document.getElementById("order-form");
      const formTitle = document.getElementById("form-title");
      const dynamicFields = document.getElementById("dynamic-fields");
      let currentService = null;

      const serviceTitles = {
        graffiti: "Graffiti Service Request",
        caricature: "Caricature Service Request",
        talks: "Talks Service Request",
      };

      const projectTypes = [
        "Mural",
        "Wall Art",
        "Installation",
        "Indoor Project",
        "Outdoor Project",
        "Other"
      ];

      const eventTypes = [
        "Corporate Event",
        "Festival",
        "Conference",
        "Workshop",
        "School Event",
        "Other"
      ];

      function generateDynamicFields(service) {
        dynamicFields.innerHTML = "";

        if (service === "graffiti") {
          const projectTypeGroup = document.createElement("div");
          projectTypeGroup.className = "form-group";
          projectTypeGroup.innerHTML = `
            <label for="project-type">Project Type *</label>
            <select id="project-type" name="projectType" required>
              <option value="">Select project type</option>
              ${projectTypes.map(type => `<option value="${type}">${type}</option>`).join("")}
            </select>
          `;
          dynamicFields.appendChild(projectTypeGroup);

          const projectSizeGroup = document.createElement("div");
          projectSizeGroup.className = "form-group";
          projectSizeGroup.innerHTML = `
            <label for="project-size">Project Size</label>
            <input type="text" id="project-size" name="projectSize" placeholder="e.g., 5m x 3m or Large scale" />
          `;
          dynamicFields.appendChild(projectSizeGroup);

          const locationGroup = document.createElement("div");
          locationGroup.className = "form-group";
          locationGroup.innerHTML = `
            <label for="location">Location</label>
            <input type="text" id="location" name="location" placeholder="City or address" />
          `;
          dynamicFields.appendChild(locationGroup);

          const dateGroup = document.createElement("div");
          dateGroup.className = "form-group";
          dateGroup.innerHTML = `
            <label for="preferred-date">Preferred Date</label>
            <input type="date" id="preferred-date" name="preferredDate" />
          `;
          dynamicFields.appendChild(dateGroup);

        } else if (service === "caricature") {
          const eventTypeGroup = document.createElement("div");
          eventTypeGroup.className = "form-group";
          eventTypeGroup.innerHTML = `
            <label for="event-type">Event Type *</label>
            <select id="event-type" name="eventType" required>
              <option value="">Select event type</option>
              ${eventTypes.map(type => `<option value="${type}">${type}</option>`).join("")}
            </select>
          `;
          dynamicFields.appendChild(eventTypeGroup);

          const eventDateGroup = document.createElement("div");
          eventDateGroup.className = "form-group";
          eventDateGroup.innerHTML = `
            <label for="event-date">Event Date</label>
            <input type="date" id="event-date" name="eventDate" />
          `;
          dynamicFields.appendChild(eventDateGroup);

          const locationGroup = document.createElement("div");
          locationGroup.className = "form-group";
          locationGroup.innerHTML = `
            <label for="location">Location</label>
            <input type="text" id="location" name="location" placeholder="City or address" />
          `;
          dynamicFields.appendChild(locationGroup);

        } else if (service === "talks") {
          const eventTypeGroup = document.createElement("div");
          eventTypeGroup.className = "form-group";
          eventTypeGroup.innerHTML = `
            <label for="event-type">Event Type *</label>
            <select id="event-type" name="eventType" required>
              <option value="">Select event type</option>
              ${eventTypes.map(type => `<option value="${type}">${type}</option>`).join("")}
            </select>
          `;
          dynamicFields.appendChild(eventTypeGroup);

          const eventDateGroup = document.createElement("div");
          eventDateGroup.className = "form-group";
          eventDateGroup.innerHTML = `
            <label for="event-date">Event Date</label>
            <input type="date" id="event-date" name="eventDate" />
          `;
          dynamicFields.appendChild(eventDateGroup);

          const locationGroup = document.createElement("div");
          locationGroup.className = "form-group";
          locationGroup.innerHTML = `
            <label for="location">Location</label>
            <input type="text" id="location" name="location" placeholder="City or address" />
          `;
          dynamicFields.appendChild(locationGroup);

          const audienceSizeGroup = document.createElement("div");
          audienceSizeGroup.className = "form-group";
          audienceSizeGroup.innerHTML = `
            <label for="audience-size">Audience Size</label>
            <input type="text" id="audience-size" name="audienceSize" placeholder="e.g., 50-100 people" />
          `;
          dynamicFields.appendChild(audienceSizeGroup);

          const topicGroup = document.createElement("div");
          topicGroup.className = "form-group";
          topicGroup.innerHTML = `
            <label for="topic-theme">Topic/Theme</label>
            <input type="text" id="topic-theme" name="topicTheme" placeholder="e.g., Street Art & Culture" />
          `;
          dynamicFields.appendChild(topicGroup);
        }
      }

      function openServiceForm(service) {
        currentService = service;
        formTitle.textContent = serviceTitles[service] || "Service Request";
        generateDynamicFields(service);
        form.reset();
        modal.classList.add("show");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }

      function closeModal() {
        modal.classList.remove("show");
        modal.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        currentService = null;
        form.reset();
      }

      // Phone number validation
      const phoneInput = document.getElementById("customer-phone");
      if (phoneInput) {
        phoneInput.addEventListener("input", function(e) {
          // Remove any non-digit characters except +, -, spaces, parentheses, and dots
          let value = e.target.value;
          // Allow only valid phone characters
          value = value.replace(/[^\d\+\-\(\)\.\s]/g, '');
          e.target.value = value;
        });

        phoneInput.addEventListener("blur", function(e) {
          const phoneValue = e.target.value.replace(/[\s\-\(\)\.]/g, '');
          // Check if it has at least 7 digits (minimum for a valid phone number)
          if (phoneValue.length > 0 && phoneValue.length < 7) {
            e.target.setCustomValidity("Enter a valid phone number :)");
          } else if (phoneValue.length > 15) {
            e.target.setCustomValidity("Phone number is too long (maximum 15 digits)");
          } else {
            e.target.setCustomValidity("");
          }
        });
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        
        // Validate phone number before submission
        const phoneInput = document.getElementById("customer-phone");
        if (phoneInput) {
          const phoneValue = phoneInput.value.replace(/[\s\-\(\)\.]/g, '');
          if (phoneValue.length < 7 || phoneValue.length > 15) {
            phoneInput.setCustomValidity("Please enter a valid phone number (7-15 digits)");
            phoneInput.reportValidity();
            return;
          } else {
            phoneInput.setCustomValidity("");
          }
        }

        const submitBtn = form.querySelector(".submit-btn");
        const originalText = submitBtn.textContent;
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.textContent = "Sending...";

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        // Prepare EmailJS template parameters
        const categoryMap = {
          graffiti: "Graffiti",
          caricature: "Caricature",
          talks: "Talks"
        };

        const templateParams = {
          category: categoryMap[currentService] || "General Contact",
          customer_name: data.name || "",
          customer_email: data.email || "",
          customer_phone: data.phone || "",
          company: data.company || "",
          subject: "", // Not used in services, but included for template compatibility
          project_type: data.projectType || "",
          project_size: data.projectSize || "",
          location: data.location || "",
          preferred_date: data.preferredDate || "",
          event_type: data.eventType || "",
          event_date: data.eventDate || "",
          audience_size: data.audienceSize || "",
          topic_theme: data.topicTheme || "",
          message: data.message || "",
        };

        // Ensure EmailJS is initialized
        if (typeof emailjs === 'undefined') {
          alert("EmailJS is not loaded. Please refresh the page and try again.");
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          return;
        }

        // Initialize EmailJS if not already done
        try {
          emailjs.init("Qi6B3pWYB6Ysn-vCi");
        } catch (e) {
          // Already initialized, continue
        }

        // Send email using EmailJS
        emailjs
          .send("service_3lv5cqe", "template_1cmxp37", templateParams)
          .then(
            function (response) {
              console.log("EmailJS success:", response);
              alert("Thank you! Your request has been sent successfully.");
              closeModal();
            },
            function (error) {
              console.error("EmailJS error details:", error);
              console.error("Error status:", error.status);
              console.error("Error text:", error.text);
              alert("Sorry, there was an error sending your request. Error: " + (error.text || error.status || "Unknown error") + ". Please check the console for details.");
            }
          )
          .finally(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          });
      });

      // Add click handlers to service cards
      document.querySelectorAll("[data-service]").forEach((card) => {
        card.addEventListener("click", () => {
          openServiceForm(card.dataset.service);
        });
        card.addEventListener("keypress", (evt) => {
          if (evt.key === "Enter" || evt.key === " ") {
            evt.preventDefault();
            openServiceForm(card.dataset.service);
          }
        });
      });

      modal
        .querySelectorAll("[data-close-modal]")
        .forEach((el) => el.addEventListener("click", closeModal));

      document.addEventListener("keydown", (evt) => {
        if (!modal.classList.contains("show")) return;
        if (evt.key === "Escape") closeModal();
      });

      initMenu();
    </script>
  </body>
</html>
